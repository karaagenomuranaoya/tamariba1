# Project Structure

```text
â”œâ”€â”€ .env.local
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ globals.css
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â””â”€â”€ room
â”‚       â””â”€â”€ [slug]
â”‚           â”œâ”€â”€ components
â”‚           â”‚   â”œâ”€â”€ ChatInput.tsx
â”‚           â”‚   â”œâ”€â”€ Header.tsx
â”‚           â”‚   â”œâ”€â”€ ImageViewer.tsx
â”‚           â”‚   â”œâ”€â”€ MessageList.tsx
â”‚           â”‚   â”œâ”€â”€ ReplyModal.tsx
â”‚           â”‚   â””â”€â”€ RoomMenu.tsx
â”‚           â”œâ”€â”€ page.tsx
â”‚           â””â”€â”€ types.ts
â”œâ”€â”€ eslint.config.mjs
â”œâ”€â”€ lib
â”‚   â””â”€â”€ supabase.ts
â”œâ”€â”€ next-env.d.ts
â”œâ”€â”€ next.config.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ postcss.config.mjs
â”œâ”€â”€ project_context_for_ai.txt
â”œâ”€â”€ textify.py
â””â”€â”€ tsconfig.json
```

---

## File: eslint.config.mjs
```mjs
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;

```

## File: next-env.d.ts
```ts
/// <reference types="next" />
/// <reference types="next/image-types/global" />
import "./.next/dev/types/routes.d.ts";

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.

```

## File: next.config.ts
```ts
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;

```

## File: package.json
```json
{
  "name": "tamariba",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.93.3",
    "next": "16.1.6",
    "react": "19.2.3",
    "react-dom": "19.2.3",
    "uuid": "^13.0.0"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.1.6",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}

```

## File: postcss.config.mjs
```mjs
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;

```

## File: tsconfig.json
```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}

```

## File: app/layout.tsx
```tsx
import type { Metadata, Viewport } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "ãŸã¾ã‚Šã°",
  description: "URLã²ã¨ã¤ã§ã€åŒ¿åãƒ»ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ãƒ»æ°—å…¼ã­ãªã—",
};

// â˜…ã“ã“ã‚’è¿½åŠ ï¼šã‚¹ãƒãƒ›ã§ã®æ‹¡å¤§ã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ–ã™ã‚‹è¨­å®š
export const viewport: Viewport = {
  width: "device-width",
  initialScale: 1,
  maximumScale: 1,
  userScalable: false, // ã“ã‚Œã§ã€Œçµ¶å¯¾æ‹¡å¤§ç¦æ­¢ã€ã«ãªã‚Šã¾ã™
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="ja">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {children}
      </body>
    </html>
  );
}
```

## File: app/page.tsx
```tsx
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { supabase } from '@/lib/supabase';
import { v4 as uuidv4 } from 'uuid';

export default function Home() {
  const router = useRouter();
  const [loading, setLoading] = useState(false);
  const [roomName, setRoomName] = useState('');

  const generateSlug = () => {
    const chars = 'abcdefghijklmnopqrstuvwxyz';
    const nums = '0123456789';
    let str = '';
    for (let i = 0; i < 3; i++) str += chars.charAt(Math.floor(Math.random() * chars.length));
    str += '-';
    for (let i = 0; i < 3; i++) str += nums.charAt(Math.floor(Math.random() * nums.length));
    return str;
  };

  // â˜… è¿½åŠ : ã€Œæ¬¡ã®æ—¥æœ¬æ™‚é–“ åˆå‰3:00ã€ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
  const getNextJst3AM = () => {
    // ç¾åœ¨æ™‚åˆ»ã‚’å–å¾—
    const now = new Date();
    
    // UTCæ™‚é–“ã«å¤‰æ›ã—ã¦è¨ˆç®—ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®PCã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è¨­å®šã«ä¾å­˜ã›ãšJSTã‚’æ‰±ã†
    // JSTã¯ UTC+9
    const jstOffset = 9 * 60; 
    const currentUtcTime = now.getTime() + (now.getTimezoneOffset() * 60000);
    const currentJstTime = new Date(currentUtcTime + (jstOffset * 60000));

    // JSTåŸºæº–ã§ã€Œä»Šæ—¥ã®3æ™‚ã€ã‚’ä½œã‚‹
    const targetJst = new Date(currentJstTime);
    targetJst.setHours(3, 0, 0, 0);

    // ã‚‚ã—ã€Œç¾åœ¨ã®JSTã€ãŒã€Œä»Šæ—¥ã®3æ™‚ã€ã‚’éãã¦ã„ãŸã‚‰ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯ã€Œæ˜æ—¥ã®3æ™‚ã€
    if (currentJstTime > targetJst) {
      targetJst.setDate(targetJst.getDate() + 1);
    }

    // è¨ˆç®—ã—ãŸJSTã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ™‚åˆ»ã‚’ã€DBä¿å­˜ç”¨ã«UTCã«æˆ»ã™
    const targetUtcTimestamp = targetJst.getTime() - (jstOffset * 60000);
    return new Date(targetUtcTimestamp).toISOString();
  };

  const createRoom = async () => {
    setLoading(true);
    try {
      const slug = generateSlug();
      const ownerToken = uuidv4();
      
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåã¯ã€ŒãŸã¾ã‚Šã°ã€
      const finalName = roomName.trim() || 'ãŸã¾ã‚Šã°';
      const expiresAt = getNextJst3AM(); // â˜… æœ‰åŠ¹æœŸé™ã‚’è¨ˆç®—

      const { error } = await supabase
        .from('tm_rooms')
        .insert([
          { 
            slug: slug, 
            owner_token: ownerToken,
            name: finalName,
            expires_at: expiresAt // â˜… DBã«è¿½åŠ 
          }
        ]);

      if (error) {
        console.error('Error creating room:', error);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
        setLoading(false);
        return;
      }

      localStorage.setItem(`tamariba_owner_${slug}`, ownerToken);
      
      // ä½œæˆç›´å¾Œã§ã‚ã‚‹ã“ã¨ã‚’ä¼ãˆã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿(?created=true)ã‚’ã¤ã‘ã¦é·ç§»
      router.push(`/room/${slug}?created=true`);

    } catch (err) {
      console.error(err);
      setLoading(false);
    }
  };

  return (
    <main className="flex min-h-screen flex-col items-center justify-center bg-gray-50 p-6">
      <div className="max-w-md w-full text-center space-y-8">
        <div>
          <h1 className="text-4xl font-bold text-gray-900 tracking-tight">ãŸã¾ã‚Šã°</h1>
          <p className="mt-4 text-lg text-gray-600">
            URLã²ã¨ã¤ã§ã€åŒ¿åãƒ»ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ãƒ»æ°—å…¼ã­ãªã—ã€‚<br />
            ç™»éŒ²ä¸è¦ã®ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ã‚’ä¸€ç¬ã§ä½œæˆã€‚
            <span className="inline-block bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded text-base font-bold mt-2">
              ğŸŒ™ æ¯æ—¥AM3:00ã«å…¨å“¡è§£æ•£
            </span>
          </p>
        </div>

        <div className="bg-white p-8 rounded-2xl shadow-sm border border-gray-100 space-y-4">
          <div>
            <label className="block text-left text-sm font-medium text-gray-700 mb-1">ãƒ«ãƒ¼ãƒ åï¼ˆä»»æ„ï¼‰</label>
            <input
              type="text"
              placeholder="ãŸã¾ã‚Šã°"
              value={roomName}
              onChange={(e) => setRoomName(e.target.value)}
              className="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors"
            />
          </div>

          <button
            onClick={createRoom}
            disabled={loading}
            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-all transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-blue-200"
          >
            {loading ? 'ä½œæˆä¸­...' : 'ãŸã¾ã‚Šå ´ã‚’ä½œã‚‹'}
          </button>
          
          <p className="mt-4 text-xs text-gray-400">
            ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨å³åº§ã«ãƒ«ãƒ¼ãƒ ãŒä½œæˆã•ã‚Œã€<br />
            å°‚ç”¨ã®URLã¸ç§»å‹•ã—ã¾ã™ã€‚
          </p>
        </div>

        <div className="text-sm text-gray-500">
          <p>ğŸ’¡ ãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾…ã¯URLã‚’ã‚·ã‚§ã‚¢ã™ã‚‹ã ã‘</p>
          <p>ğŸ’¡ ãƒ«ãƒ¼ãƒ ã®å‰Šé™¤æ¨©é™ã¯ä½œã£ãŸäººã ã‘</p>
        </div>
      </div>
    </main>
  );
}
```

## File: app/room/[slug]/page.tsx
```tsx
'use client';

import { useEffect, useState } from 'react';
import { useParams, useRouter, useSearchParams } from 'next/navigation';
import { supabase } from '@/lib/supabase';
import { Message } from './types';

// Components
import Header from './components/Header';
import RoomMenu from './components/RoomMenu';
import MessageList from './components/MessageList';
import ChatInput from './components/ChatInput';
import ImageViewer from './components/ImageViewer';
import ReplyModal from './components/ReplyModal'; // è¿½åŠ 

export default function RoomPage() {
  const { slug } = useParams() as { slug: string };
  const router = useRouter();
  const searchParams = useSearchParams();

  // Room State
  const [roomId, setRoomId] = useState<string | null>(null);
  const [roomName, setRoomName] = useState('');
  const [loading, setLoading] = useState(true);
  const [isHost, setIsHost] = useState(false);
  const [showMenu, setShowMenu] = useState(false);

  // Message State
  const [messages, setMessages] = useState<Message[]>([]);
  
  // â˜… è¿½åŠ : è¿”ä¿¡ã‚¹ãƒ¬ãƒƒãƒ‰ã®çŠ¶æ…‹
  const [activeThread, setActiveThread] = useState<Message | null>(null);

  // ImageViewer State
  const [viewerIndex, setViewerIndex] = useState<number | null>(null);

  // ç”»åƒã®æœ‰åŠ¹æœŸé™åˆ‡ã‚Œåˆ¤å®š
  const isImageExpired = (createdAt: string) => {
    const created = new Date(createdAt).getTime();
    return (new Date().getTime() - created) > 24 * 60 * 60 * 1000;
  };

  const imageMessages = messages.filter(m => m.image_url && !isImageExpired(m.created_at));

  // 1. ãƒ«ãƒ¼ãƒ æƒ…å ±ã®å–å¾— (å¤‰æ›´ãªã—)
  useEffect(() => {
    const fetchRoom = async () => {
      if (!slug) return;
      
      const { data, error } = await supabase
        .from('tm_rooms')
        .select('id, name') 
        .eq('slug', slug)
        .single();
      
      if (error || !data) {
        alert('ã“ã®ãƒ«ãƒ¼ãƒ ã¯å­˜åœ¨ã—ãªã„ã‹ã€å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚');
        router.push('/');
        return;
      }
      setRoomId(data.id);
      setRoomName(data.name || 'ãŸã¾ã‚Šã°');

      const ownerToken = localStorage.getItem(`tamariba_owner_${slug}`);
      if (ownerToken) setIsHost(true);

      if (searchParams.get('created') === 'true') {
        setShowMenu(true);
        router.replace(`/room/${slug}`);
      }
    };
    fetchRoom();
  }, [slug, router, searchParams]);

  // 2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ«ãƒ¼ãƒ åã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–° (å¤‰æ›´ãªã—)
  useEffect(() => {
    if (!roomId) return;
    
    // åˆæœŸãƒ­ãƒ¼ãƒ‰
    const fetchMessages = async () => {
      const { data } = await supabase.from('tm_messages').select('*').eq('room_id', roomId).order('created_at', { ascending: true });
      if (data) setMessages(data);
      setLoading(false);
    };
    fetchMessages();

    // è³¼èª­é–‹å§‹
    const msgChannel = supabase.channel(`room:${roomId}`)
      .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'tm_messages', filter: `room_id=eq.${roomId}` }, 
      (payload) => { setMessages((prev) => [...prev, payload.new as Message]); })
      .subscribe();
    
    const roomChannel = supabase.channel(`room_meta:${roomId}`)
      .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'tm_rooms', filter: `id=eq.${roomId}` },
      (payload) => {
        if (payload.new && 'name' in payload.new) {
            setRoomName(payload.new.name);
        }
      })
      // â˜… è¿½åŠ : ãƒ«ãƒ¼ãƒ å‰Šé™¤ï¼ˆè§£æ•£ï¼‰ã®æ¤œçŸ¥
      .on('postgres_changes', { event: 'DELETE', schema: 'public', table: 'tm_rooms', filter: `id=eq.${roomId}` },
      () => {
        alert('åˆå‰3æ™‚ã«ãªã‚Šã¾ã—ãŸã€‚\nã€ŒãŸã¾ã‚Šã°ã€ã¯è§£æ•£ã—ã¾ã—ãŸã€‚ã¾ãŸæ˜æ—¥ã€‚');
        router.push('/');
      })
      .subscribe();

    return () => { 
        supabase.removeChannel(msgChannel); 
        supabase.removeChannel(roomChannel);
    };
  }, [roomId]);

  // Viewer Handlers (å¤‰æ›´ãªã—)
  const openViewer = (url: string) => {
    const index = imageMessages.findIndex(m => m.image_url === url);
    if (index !== -1) setViewerIndex(index);
  };

  const nextImage = () => {
    if (viewerIndex === null) return;
    setViewerIndex((prev) => (prev! + 1) % imageMessages.length);
  };

  const prevImage = () => {
    if (viewerIndex === null) return;
    setViewerIndex((prev) => (prev! - 1 + imageMessages.length) % imageMessages.length);
  };

  if (loading) return <div className="flex items-center justify-center h-dvh text-gray-500">èª­ã¿è¾¼ã¿ä¸­...</div>;

  return (
    <div className="flex flex-col h-dvh bg-gray-100">
      
      <Header 
        roomName={roomName} 
        slug={slug} 
        showMenu={showMenu} 
        setShowMenu={setShowMenu} 
      />

      {showMenu && roomId && (
        <RoomMenu 
          slug={slug}
          roomId={roomId}
          isHost={isHost}
          roomName={roomName}
          setRoomName={setRoomName}
          onClose={() => setShowMenu(false)}
        />
      )}

      {/* MessageList ã« onReplyClick ã‚’æ¸¡ã™ */}
      <MessageList 
        messages={messages} 
        onImageClick={openViewer} 
        onReplyClick={(msg) => setActiveThread(msg)} 
        onCloseMenu={() => setShowMenu(false)} 
      />

      {roomId && <ChatInput roomId={roomId} />}

      {/* Reply Modal (ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¹ãƒ¬ãƒƒãƒ‰ãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤º) */}
      {activeThread && roomId && (
        <ReplyModal 
            roomId={roomId}
            parentMessage={activeThread}
            allMessages={messages}
            onClose={() => setActiveThread(null)}
        />
      )}

      {viewerIndex !== null && imageMessages[viewerIndex] && (
        <ImageViewer
          imageUrl={imageMessages[viewerIndex].image_url!}
          nickname={imageMessages[viewerIndex].nickname}
          currentIndex={viewerIndex}
          total={imageMessages.length}
          onClose={() => setViewerIndex(null)}
          onNext={nextImage}
          onPrev={prevImage}
        />
      )}
    </div>
  );
}
```

## File: app/room/[slug]/types.ts
```ts
export type Message = {
  id: string;
  nickname: string;
  content: string;
  created_at: string;
  image_url?: string | null;
  parent_id?: string | null; // è¿½åŠ 
};
```

## File: app/room/[slug]/components/ChatInput.tsx
```tsx
'use client';

import { useState, useRef, useEffect } from 'react';
import { supabase } from '@/lib/supabase';
import { v4 as uuidv4 } from 'uuid';

const DEFAULT_NICKNAME = 'ã‹ã‚‰ã‚ã’';

type Props = {
  roomId: string;
};

export default function ChatInput({ roomId }: Props) {
  const [nickname, setNickname] = useState('');
  const [newMessage, setNewMessage] = useState('');
  const [selectedImage, setSelectedImage] = useState<File | null>(null);
  const [isUploading, setIsUploading] = useState(false);

  const fileInputRef = useRef<HTMLInputElement>(null);
  const textareaRef = useRef<HTMLTextAreaElement>(null);

  // â˜… è¿½åŠ : ãƒã‚¦ãƒ³ãƒˆæ™‚ã«ä¿å­˜ã•ã‚ŒãŸãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å¾©å…ƒ
  useEffect(() => {
    if (roomId) {
      const savedName = localStorage.getItem(`tamariba_nickname_${roomId}`);
      if (savedName) {
        setNickname(savedName);
      }
    }
  }, [roomId]);

  const adjustTextareaHeight = () => {
    const textarea = textareaRef.current;
    if (textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = `${Math.min(textarea.scrollHeight, 150)}px`;
    }
  };

  const sendMessage = async (e: React.FormEvent) => {
    e.preventDefault();
    if ((!newMessage.trim() && !selectedImage) || !roomId) return;

    // â˜… è¿½åŠ : é€ä¿¡æ™‚ã«ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’ä¿å­˜ï¼ˆç©ºæ–‡å­—ã®å ´åˆã‚‚ãã®ã¾ã¾ä¿å­˜ã—ã¦ã€æ¬¡å›ç©ºæ¬„ã«ã™ã‚‹ï¼‰
    localStorage.setItem(`tamariba_nickname_${roomId}`, nickname);

    const finalNickname = nickname.trim() || DEFAULT_NICKNAME;
    let imageUrl = null;

    if (selectedImage) {
      setIsUploading(true);
      const fileExt = selectedImage.name.split('.').pop();
      const fileName = `${uuidv4()}.${fileExt}`;
      const filePath = `${roomId}/${fileName}`;
      
      const { error: uploadError } = await supabase.storage.from('tm-images').upload(filePath, selectedImage);
      if (uploadError) {
        alert('ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ');
        setIsUploading(false);
        return;
      }
      
      const { data } = supabase.storage.from('tm-images').getPublicUrl(filePath);
      imageUrl = data.publicUrl;
      setIsUploading(false);
    }

    await supabase.from('tm_messages').insert([
      {
        room_id: roomId,
        nickname: finalNickname,
        content: newMessage,
        image_url: imageUrl,
      },
    ]);

    setNewMessage('');
    setSelectedImage(null);
    if (fileInputRef.current) fileInputRef.current.value = '';
    if (textareaRef.current) textareaRef.current.style.height = 'auto';
  };

  return (
    <div className="bg-white border-t border-gray-200 shrink-0 pb-safe">
      <form onSubmit={sendMessage} className="flex flex-col max-w-screen-md mx-auto">
        {selectedImage && (
          <div className="px-3 pt-3">
            <div className="flex items-center justify-between bg-blue-50 p-2 px-3 rounded-lg text-sm text-blue-800 border border-blue-100">
              <span className="truncate">{selectedImage.name}</span>
              <button
                type="button"
                onClick={() => {
                  setSelectedImage(null);
                  if (fileInputRef.current) fileInputRef.current.value = '';
                }}
                className="text-blue-400 hover:text-blue-600 p-1"
              >
                âœ•
              </button>
            </div>
          </div>
        )}

        <div className="px-3 pt-2">
          <input
            type="text"
            placeholder={`åå‰ (çœç•¥: ${DEFAULT_NICKNAME})`}
            value={nickname}
            onChange={(e) => setNickname(e.target.value)}
            className="text-xs text-gray-500 bg-transparent placeholder-gray-400 focus:outline-none focus:text-blue-600 py-1 w-full"
          />
        </div>

        <div className="flex gap-2 items-end px-3 pb-3 pt-1">
          <label className="shrink-0 p-2.5 text-gray-500 bg-gray-50 hover:bg-gray-100 active:bg-gray-200 rounded-full cursor-pointer transition-colors mb-0.5">
            <input
              type="file"
              accept="image/*"
              className="hidden"
              ref={fileInputRef}
              onChange={(e) => {
                if (e.target.files?.[0]) setSelectedImage(e.target.files[0]);
              }}
            />
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
              <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
            </svg>
          </label>

          <textarea
            ref={textareaRef}
            placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸..."
            value={newMessage}
            rows={1}
            onChange={(e) => {
              setNewMessage(e.target.value);
              adjustTextareaHeight();
            }}
            className="flex-1 p-3 bg-gray-50 border-0 rounded-2xl focus:ring-2 focus:ring-blue-100 focus:bg-white transition-all text-base min-h-[44px] max-h-[150px] resize-none overflow-y-auto leading-relaxed"
          />

          <button
            type="submit"
            disabled={(!newMessage && !selectedImage) || isUploading}
            className="shrink-0 bg-blue-600 text-white p-3 rounded-full font-bold shadow-sm active:scale-95 transition-all disabled:opacity-30 disabled:active:scale-100 mb-0.5"
          >
            {isUploading ? (
              <span className="block w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
            ) : (
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-5 h-5 translate-x-0.5 -translate-y-0.5">
                <path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" />
              </svg>
            )}
          </button>
        </div>
      </form>
    </div>
  );
}
```

## File: app/room/[slug]/components/Header.tsx
```tsx
'use client';

import { useRouter } from 'next/navigation';

type Props = {
  roomName: string;
  slug: string;
  showMenu: boolean;
  setShowMenu: (show: boolean) => void;
};

export default function Header({ roomName, slug, showMenu, setShowMenu }: Props) {
  const router = useRouter();

  return (
    <header className="bg-white px-4 py-3 shadow-sm flex justify-between items-center z-20 shrink-0 relative">
      <div className="flex items-center gap-3 overflow-hidden">
        <button onClick={() => router.push('/')} className="text-gray-400 hover:text-gray-600 p-1 -ml-1">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5">
            <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
          </svg>
        </button>
        <div className="flex flex-col">
          <h1 className="font-bold text-gray-800 text-base leading-tight truncate max-w-[180px] sm:max-w-xs">
            {roomName}
          </h1>
          <p className="text-[10px] text-gray-400 font-mono leading-none mt-0.5">ID: {slug}</p>
        </div>
      </div>

      <button
        onClick={() => setShowMenu(!showMenu)}
        className="bg-gray-50 p-2 rounded-full hover:bg-gray-200 text-gray-600 active:bg-gray-200 transition-colors"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
          <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
      </button>
    </header>
  );
}
```

## File: app/room/[slug]/components/ImageViewer.tsx
```tsx
'use client';

type Props = {
  imageUrl: string | null;
  nickname?: string;
  currentIndex: number;
  total: number;
  onClose: () => void;
  onNext: () => void;
  onPrev: () => void;
};

export default function ImageViewer({ imageUrl, nickname, currentIndex, total, onClose, onNext, onPrev }: Props) {
  if (!imageUrl) return null;

  return (
    <div
      className="fixed inset-0 z-50 bg-black/95 flex flex-col items-center justify-center animate-in fade-in duration-200"
      onClick={onClose}
    >
      <button onClick={onClose} className="absolute top-4 right-4 text-white/70 hover:text-white p-2 z-50">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-8 h-8">
          <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

      <div className="relative w-full h-full flex items-center justify-center p-4">
        {/* eslint-disable-next-line @next/next/no-img-element */}
        <img
          src={imageUrl}
          alt="viewing"
          className="max-h-full max-w-full object-contain shadow-2xl"
          onClick={(e) => e.stopPropagation()}
        />
      </div>

      {total > 1 && (
        <>
          <button
            onClick={(e) => { e.stopPropagation(); onPrev(); }}
            className="absolute left-2 top-1/2 -translate-y-1/2 bg-white/10 hover:bg-white/20 text-white p-3 rounded-full backdrop-blur-sm transition-all active:scale-95"
          >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-6 h-6">
              <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
            </svg>
          </button>
          <button
            onClick={(e) => { e.stopPropagation(); onNext(); }}
            className="absolute right-2 top-1/2 -translate-y-1/2 bg-white/10 hover:bg-white/20 text-white p-3 rounded-full backdrop-blur-sm transition-all active:scale-95"
          >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-6 h-6">
              <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
            </svg>
          </button>
        </>
      )}

      <div className="absolute bottom-6 left-0 right-0 text-center text-white/80 text-sm font-medium pb-safe">
        <p>{nickname}</p>
        <p className="text-xs text-white/50 mt-1">
          {currentIndex + 1} / {total}
        </p>
      </div>
    </div>
  );
}
```

## File: app/room/[slug]/components/MessageList.tsx
```tsx
'use client';

import { useEffect, useRef } from 'react';
import { Message } from '../types';

type Props = {
  messages: Message[];
  onImageClick: (url: string) => void;
  onReplyClick: (message: Message) => void; // è¿½åŠ 
  onCloseMenu: () => void;
};

const isImageExpired = (createdAt: string) => {
  const created = new Date(createdAt).getTime();
  return new Date().getTime() - created > 24 * 60 * 60 * 1000;
};

export default function MessageList({ messages, onImageClick, onReplyClick, onCloseMenu }: Props) {
  const messagesEndRef = useRef<HTMLDivElement>(null);

  // è¦ªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®æŠ•ç¨¿ï¼‰ã®ã¿ã‚’æŠ½å‡ºã—ã¦è¡¨ç¤º
  const rootMessages = messages.filter((m) => !m.parent_id);

  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [rootMessages.length]); // rootMessagesã®å¤‰æ›´ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«

  // ç‰¹å®šã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¯¾ã™ã‚‹è¿”ä¿¡æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹é–¢æ•°
  const getReplyCount = (parentId: string) => {
    return messages.filter((m) => m.parent_id === parentId).length;
  };

  return (
    <div
      className="flex-1 overflow-y-auto p-3 space-y-4 bg-slate-50 scroll-smooth"
      onClick={onCloseMenu}
    >
      {rootMessages.map((msg) => {
        const replyCount = getReplyCount(msg.id);
        
        return (
          <div key={msg.id} className="group flex flex-col items-start max-w-[95%] relative">
            <div className="flex items-baseline gap-2 mb-1 ml-1">
              <span className="text-xs font-bold text-gray-600 truncate max-w-[150px]">
                {msg.nickname}
              </span>
              <span className="text-[10px] text-gray-400">
                {new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
              </span>
            </div>

            <div className="flex items-end gap-2 w-full">
              {/* Message Bubble */}
              <div className="flex-1 min-w-0">
                {msg.content && (
                  <div className="bg-white px-3.5 py-2.5 rounded-2xl rounded-tl-none shadow-[0_1px_2px_rgba(0,0,0,0.06)] border border-gray-100 text-[15px] leading-relaxed text-gray-800 break-words whitespace-pre-wrap">
                    {msg.content}
                  </div>
                )}

                {msg.image_url && (
                  <div className={`ml-1 ${msg.content ? 'mt-1.5' : 'mt-0'}`}>
                    {isImageExpired(msg.created_at) ? (
                      <div className="bg-gray-100 p-4 rounded text-[10px] text-gray-400 border border-dashed border-gray-300">
                        ğŸš« ç”»åƒæœŸé™åˆ‡ã‚Œ
                      </div>
                    ) : (
                      // eslint-disable-next-line @next/next/no-img-element
                      <img
                        src={msg.image_url}
                        alt="posted"
                        onClick={() => onImageClick(msg.image_url!)}
                        className="rounded-xl border border-gray-100 max-h-60 object-contain bg-white cursor-pointer hover:opacity-95 transition-opacity"
                      />
                    )}
                  </div>
                )}
              </div>

              {/* Reply Button (å³å´ã«ã¡ã‚‡ã‚ã£ã¨çŸ¢å°) */}
              <button
                onClick={(e) => {
                  e.stopPropagation();
                  onReplyClick(msg);
                }}
                className="shrink-0 mb-1 p-1.5 rounded-full text-gray-300 hover:text-blue-500 hover:bg-blue-50 transition-colors flex items-center gap-1"
                aria-label="è¿”ä¿¡"
              >
                 {replyCount > 0 ? (
                    <div className="flex items-center gap-1">
                        <span className="text-[10px] font-bold text-blue-500">{replyCount}</span>
                         {/* è¿”ä¿¡ã‚ã‚Šã®å ´åˆ: é’è‰²ã§ç›®ç«‹ãŸã›ã‚‹ */}
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-4 h-4 text-blue-400">
                            <path fillRule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm.53 5.47a.75.75 0 00-1.06 0l-3 3a.75.75 0 000 1.06l3 3a.75.75 0 101.06-1.06l-1.72-1.72h5.69c1.19 0 2.155.877 2.244 2.036l.006.104V15a.75.75 0 001.5 0v-1.11c0-1.884-1.428-3.447-3.262-3.633l-.159-.007H10.81l1.72-1.72a.75.75 0 000-1.06z" clipRule="evenodd" />
                        </svg>
                    </div>
                 ) : (
                    // è¿”ä¿¡ãªã—ã®å ´åˆ: ã‚°ãƒ¬ãƒ¼ã§æ§ãˆã‚ã«
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-4 h-4 -scale-x-100">
                      <path strokeLinecap="round" strokeLinejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" />
                    </svg>
                 )}
              </button>
            </div>
          </div>
        );
      })}
      <div ref={messagesEndRef} className="h-2" />
    </div>
  );
}
```

## File: app/room/[slug]/components/ReplyModal.tsx
```tsx
'use client';

import { useState, useRef, useEffect } from 'react';
import { supabase } from '@/lib/supabase';
import { Message } from '../types';

type Props = {
  roomId: string;
  parentMessage: Message;
  allMessages: Message[]; // å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ãƒªãƒ—ãƒ©ã‚¤ã‚’æŠ½å‡ºã—ã¦è¡¨ç¤º
  onClose: () => void;
};

const DEFAULT_NICKNAME = 'ã‹ã‚‰ã‚ã’';

export default function ReplyModal({ roomId, parentMessage, allMessages, onClose }: Props) {
  const [nickname, setNickname] = useState('');
  const [replyContent, setReplyContent] = useState('');
  const [isSending, setIsSending] = useState(false);
  const scrollRef = useRef<HTMLDivElement>(null);

  // ã“ã®è¦ªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¯¾ã™ã‚‹è¿”ä¿¡ã®ã¿ã‚’æŠ½å‡º
  const replies = allMessages.filter((m) => m.parent_id === parentMessage.id);

  // æœ€æ–°ã®è¿”ä¿¡ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  useEffect(() => {
    if (scrollRef.current) {
      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
    }
  }, [replies.length]);

  // â˜… è¿½åŠ : ãƒã‚¦ãƒ³ãƒˆæ™‚ã«ä¿å­˜ã•ã‚ŒãŸãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å¾©å…ƒï¼ˆChatInputã¨å…±æœ‰ï¼‰
  useEffect(() => {
    if (roomId) {
      const savedName = localStorage.getItem(`tamariba_nickname_${roomId}`);
      if (savedName) {
        setNickname(savedName);
      }
    }
  }, [roomId]);

  const sendReply = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!replyContent.trim() || isSending) return;

    setIsSending(true);

    // â˜… è¿½åŠ : é€ä¿¡æ™‚ã«ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’ä¿å­˜
    localStorage.setItem(`tamariba_nickname_${roomId}`, nickname);

    const finalNickname = nickname.trim() || DEFAULT_NICKNAME;

    await supabase.from('tm_messages').insert([
      {
        room_id: roomId,
        nickname: finalNickname,
        content: replyContent,
        parent_id: parentMessage.id, // è¦ªIDã‚’æŒ‡å®š
      },
    ]);

    setReplyContent('');
    setIsSending(false);
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 animate-in fade-in duration-200" onClick={onClose}>
      <div 
        className="w-full max-w-md bg-white rounded-2xl shadow-2xl flex flex-col max-h-[80vh] overflow-hidden"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="px-4 py-3 border-b border-gray-100 flex justify-between items-center bg-gray-50">
          <h3 className="text-sm font-bold text-gray-700">è¿”ä¿¡ã‚¹ãƒ¬ãƒƒãƒ‰</h3>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600 p-1">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5">
              <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        {/* Thread Content */}
        <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-white" ref={scrollRef}>
          {/* è¦ªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå°‘ã—å¼·èª¿ï¼‰ */}
          <div className="pl-2 border-l-4 border-gray-200">
            <div className="flex items-baseline gap-2 mb-1">
              <span className="text-xs font-bold text-gray-600">{parentMessage.nickname}</span>
              <span className="text-[10px] text-gray-400">
                {new Date(parentMessage.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
              </span>
            </div>
            <div className="text-sm text-gray-800 whitespace-pre-wrap">{parentMessage.content}</div>
            {parentMessage.image_url && (
               <div className="mt-2 text-xs text-gray-400">[ç”»åƒ]</div>
            )}
          </div>

          <div className="border-t border-gray-100 my-2"></div>

          {/* è¿”ä¿¡ä¸€è¦§ */}
          {replies.length === 0 ? (
            <div className="text-center text-xs text-gray-400 py-4">ã¾ã è¿”ä¿¡ã¯ã‚ã‚Šã¾ã›ã‚“</div>
          ) : (
            replies.map((msg) => (
              <div key={msg.id} className="flex flex-col items-start">
                <div className="flex items-baseline gap-2 mb-1">
                  <span className="text-xs font-bold text-blue-600">{msg.nickname}</span>
                  <span className="text-[10px] text-gray-400">
                    {new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                  </span>
                </div>
                <div className="bg-blue-50 px-3 py-2 rounded-xl rounded-tl-none text-sm text-gray-800 whitespace-pre-wrap">
                  {msg.content}
                </div>
              </div>
            ))
          )}
        </div>

        {/* Reply Input */}
        <form onSubmit={sendReply} className="p-3 border-t border-gray-100 bg-gray-50">
           <input
            type="text"
            placeholder={`åå‰ (çœç•¥: ${DEFAULT_NICKNAME})`}
            value={nickname}
            onChange={(e) => setNickname(e.target.value)}
            className="text-xs text-gray-500 bg-transparent placeholder-gray-400 focus:outline-none mb-2 w-full px-1"
          />
          <div className="flex gap-2">
            <input
              type="text"
              className="flex-1 p-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-blue-400 transition-colors"
              placeholder="è¿”ä¿¡ã‚’å…¥åŠ›..."
              value={replyContent}
              onChange={(e) => setReplyContent(e.target.value)}
            />
            <button
              type="submit"
              disabled={!replyContent || isSending}
              className="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold disabled:opacity-50"
            >
              é€ä¿¡
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}
```

## File: app/room/[slug]/components/RoomMenu.tsx
```tsx
'use client';

import { useState } from 'react';
import { supabase } from '@/lib/supabase';
import { useRouter } from 'next/navigation';

type Props = {
  slug: string;
  roomId: string;
  isHost: boolean;
  roomName: string;
  setRoomName: (name: string) => void;
  onClose: () => void;
};

export default function RoomMenu({ slug, roomId, isHost, roomName, setRoomName, onClose }: Props) {
  const router = useRouter();
  const [isCopied, setIsCopied] = useState(false);

  const copyUrl = () => {
    navigator.clipboard.writeText(window.location.href);
    setIsCopied(true);
    setTimeout(() => setIsCopied(false), 2000);
  };

  const updateRoomName = async () => {
    const newName = prompt('æ–°ã—ã„ãƒ«ãƒ¼ãƒ åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', roomName);
    if (newName === null || newName === roomName) return;
    if (!newName.trim()) {
      alert('ãƒ«ãƒ¼ãƒ åã¯ç©ºã«ã§ãã¾ã›ã‚“');
      return;
    }

    const ownerToken = localStorage.getItem(`tamariba_owner_${slug}`);
    if (!roomId || !ownerToken) return;

    const { error } = await supabase
      .from('tm_rooms')
      .update({ name: newName })
      .eq('id', roomId)
      .eq('owner_token', ownerToken);

    if (error) console.error(error);
    else setRoomName(newName);
  };

  const deleteRoom = async () => {
    if (!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆå¾©å…ƒã§ãã¾ã›ã‚“ï¼‰')) return;
    const ownerToken = localStorage.getItem(`tamariba_owner_${slug}`);
    if (!roomId || !ownerToken) return;
    const { error } = await supabase.from('tm_rooms').delete().eq('id', roomId).eq('owner_token', ownerToken);
    if (!error) {
      localStorage.removeItem(`tamariba_owner_${slug}`);
      router.push('/');
    }
  };

  return (
    <>
      <div className="fixed inset-0 z-20 bg-black/10" onClick={onClose}></div>
      <div className="absolute top-14 right-2 w-72 bg-white shadow-xl rounded-xl border border-gray-100 overflow-hidden animate-in fade-in zoom-in duration-200 z-30">
        <div className="p-5 border-b border-gray-100 text-center">
          <p className="text-xs text-gray-400 mb-3">æ‹›å¾…ç”¨QRã‚³ãƒ¼ãƒ‰</p>
          <img
            src={`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${typeof window !== 'undefined' ? window.location.href : ''}`}
            alt="QR"
            className="mx-auto mb-4 w-32 h-32"
          />

          <button
            onClick={copyUrl}
            className={`w-full py-3 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition-all ${
              isCopied ? 'bg-green-100 text-green-700' : 'bg-blue-50 text-blue-600 hover:bg-blue-100'
            }`}
          >
            {isCopied ? 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ' : 'URLã‚’ã‚³ãƒ”ãƒ¼'}
          </button>
        </div>

        {isHost ? (
          <div className="bg-gray-50">
            <button
              onClick={updateRoomName}
              className="w-full text-left p-4 text-gray-700 text-sm hover:bg-gray-100 font-medium flex items-center gap-3 border-b border-gray-100"
            >
              {/* ã‚¢ã‚¤ã‚³ãƒ³çœç•¥ï¼ˆå¿…è¦ãªã‚‰å…ƒã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ï¼‰ */}
              <span className="flex-1">ãƒ«ãƒ¼ãƒ åã‚’å¤‰æ›´</span>
            </button>
            <button
              onClick={deleteRoom}
              className="w-full text-left p-4 text-red-600 text-sm hover:bg-red-50 font-bold flex items-center gap-3"
            >
              <span className="flex-1">ã“ã®ãƒ«ãƒ¼ãƒ ã‚’å‰Šé™¤</span>
            </button>
          </div>
        ) : (
          <div className="p-3 text-xs text-gray-400 text-center bg-gray-50">ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆæ¨©é™ãªã—ï¼‰</div>
        )}
      </div>
    </>
  );
}
```

## File: lib/supabase.ts
```ts
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
```

